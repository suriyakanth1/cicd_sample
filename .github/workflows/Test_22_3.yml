name: Test_22_3

on:
  workflow_dispatch:
  push:
    

jobs:
  build:
    name: GITHUB
    runs-on: ubuntu-latest
    steps:
      - name: Check out the repo
        uses: actions/checkout@v3  

  #---------------- Docker
  DOCKERHUB:
    needs: [build]
    runs-on: ubuntu-latest
    environment:
      name: DEVELOPMENT
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3
      - name: Login to Docker Hub
        uses: docker/login-action@v2
        with:
          username: suriyakanth1
          password: dckr_pat_LSDYW7uqWPPYvQOrLJFEbl7oPjM
      - name: Build and push
        uses: docker/build-push-action@v5
        with:
          push: true
          tags: suriyakanth1/dockerimagebuild:main

  #--------------- BUILDSCRIPT
  BUILDSCRIPT:
    runs-on: ubuntu-latest
    needs: [DOCKERHUB]
    steps:
      - name: Run script on the VM
        run: |
          sshpass -p "ClearC0de20S4" ssh -o StrictHostKeyChecking=no root@158.220.107.63 <<EOF
        

          # Step 1: Change to the directory 
          cd ~/projects/script_test

          # Step 2: Write Java source code to a file
          echo 'public class Main { public static void main(String[] args) { System.out.println("Hello, world!"); } }' > Main.java

          # Step 3: Compile Java source code
          javac Main.java

          # Step 4: Create manifest file specifying the main class
          echo 'Main-Class: Main' > manifest.txt

          # Step 5: Create JAR file using the compiled class file and manifest file
          jar cfm Main.jar manifest.txt Main.class

          # Step 6: Run the JAR file
          java -jar Main.jar
