
    name: modelpipeline
    
    on:
      push:
    
    jobs:
      build:
         name: github
         runs-on: ubuntu-latest
         steps:
            - name: Check out the repo
              uses: actions/checkout@v3  
    #---------------- Docker
      docker:
        needs : [build]
        runs-on: ubuntu-latest
        steps:
            - name: Check out the repo
              uses: actions/checkout@v3
            - name: Log in to Docker Hub
              uses: docker/login-action@f054a8b539a109f9f41c372932f1ae047eff08c9
              with:
                username: suriyakanth1
                password: dckr_pat_LSDYW7uqWPPYvQOrLJFEbl7oPjM
              
            - name: Extract metadata (tags, labels) for Docker
              id: meta
              uses: docker/metadata-action@98669ae865ea3cffbcbaa878cf57c20bbf1c6c38
              with:
                images: suriyakanth1/dockerimagebuild
          
            - name: Build and push Docker image
              uses: docker/build-push-action@ad44023a93711e3deb337508980b4b5e9bcdc5dc
              with:
                context: .
                push: true
                tags: ${{ steps.meta.outputs.tags }}
                labels: ${{ steps.meta.outputs.labels }}
      #---------------- sonarqube
      sonarqube:
          needs : [docker]
          runs-on: ubuntu-latest
          steps:
              - uses: actions/checkout@master
              - name: SonarQube Scan
                uses: sonarsource/sonarqube-scan-action@master
          env:
               SONAR_TOKEN: squ_8c5e7438e05474ebcb879b70892d439619fe4daa
               SONAR_HOST_URL: http://158.220.107.63:9000/
      deploy:
            runs-on: ubuntu-latest
            needs: [sonarqube]
            steps:
              - name: Checkout code
                uses: actions/checkout@v2

              - name: SSH into the server
                uses: appleboy/ssh-action@master
                with:
                  host: 158.220.107.63
                  username: root
                  key: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDOCfYEf8qH7PiAq289QtJdfjdpGBLIDUiNdUddHoTNRFyrLotSeGGM7kgvIumCVfrkvfCjhTPIJXDBgl7Z2Izy2o4f44tHUIWKXlImwyAMMBuNq4D9y7Ishul9TvKuwxI3Rbi0szQF8LwBYFeoRCslJjydmYQCW9BxMEwihXP5VZ0SCvPGcJtfQZvBdGq7Ozmk4pVu4qaPEUOwHE4bjt3H0mbE2yPwi2WL6us4goh/8H42BoufkMeDI3O3747wiqjj5eQH3ySilEZ6r8AqfSj2Y+ZHj2sH/m/956/enkFA+U/zrgYRrn7hHBM6I2I7PVM4okB/K6CMaxHHIovRlGuHf3lV+dyOMTs+cYLdYhH5WodY8xrI0I3RwsDqSqKUxSMyCtDZzEcAIhprZj2eWL31JS62vYoLqIm2InVfWeR1n3meal64JHm/0Dun0kUytHY+nyphyH2zbtJhtIrjENzvHGE8Xcd9b/VZfqVZNBd7kUawva6qkQMdNMZ5Cn548ojmF/qJnngheZjnvlkXVF9DXP3hB0WUONyUe3qUmOXo5KtL7QFaeBwl+mgjxTNupFoyOIZCfgz0J8eqwRwIPV0qrQHG2aCz11zzfkJuBlDCwrjdKbhkg3hHaUm7TIAaKpCLg7969QiM2C5XRY23tD96B6Lses7zj8iL9kT7qvjFpw== suriya271999@gmail.com
                  port: 22

              - name: Pull Docker Image
                run: suriyakanth1/dockerimagebuild:main
                env:
                  DOCKER_USERNAME: suriyakanth1
                  DOCKER_PASSWORD: dckr_pat_LSDYW7uqWPPYvQOrLJFEbl7oPjM

              - name: Run Docker Container
                run: |
                  docker run -d \
                    --name suriyakanth1/dockerimagebuild \
                    -p 3000:3000 \
                    suriyakanth1/dockerimagebuild:main
                env:
                  DOCKER_USERNAME: suriyakanth1
                  DOCKER_PASSWORD: dckr_pat_LSDYW7uqWPPYvQOrLJFEbl7oPjM
      
