        name: vm-sonar-test

        on:                  
          workflow_dispatch:
                             

        jobs:
          build:
           name: GITHUB
           runs-on: ubuntu-latest
           steps:
                - name: Check out the repo
                  uses: actions/checkout@v3  
            



        #---------------- sonarqube
          SONARQUBE:
            needs : [build]
            runs-on: ubuntu-latest
            steps:
                - uses: actions/checkout@master
                - name: SonarQube Scan
                  uses: sonarsource/sonarqube-scan-action@master
            env:
                 SONAR_TOKEN: squ_8c5e7438e05474ebcb879b70892d439619fe4daa
                 SONAR_HOST_URL: http://158.220.107.63:9000/
        

        #---------------- VM
          VIRTUAL_MACHINE:
            runs-on: ubuntu-latest
            needs: [SONARQUBE]
            steps:
               - name: Checkout code
                 uses: actions/checkout@v3

               - name: Deploy to Linux Server
                 uses: appleboy/ssh-action@master
                with:
                host: 158.220.107.63
                username: root
                password: ClearC0de20S4  # Storing passwords as secrets is more secure
                port: 22
                script: |
                    cd /root/projects/cicdapp/cicd_sample/
                    git pull origin test
                    git status
                    npm install
                    node index.js
                    sleep 10
             